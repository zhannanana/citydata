<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <meta name="description" content="">
  <meta name="author" content="">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
  <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=zWjIGHqOwWY5Y6POTiGuLgXzabUCL5ql"></script>
  <script type="text/javascript" src="http://api.map.baidu.com/library/Heatmap/2.0/src/Heatmap_min.js"></script>

  <title>Dashboard Template for Bootstrap</title>
  <!-- 引入 ECharts 文件 -->
  <script src="../../js/echarts.min.js"></script>
  <script  src="../../js/jquery.min.js"></script>
  <!-- Bootstrap core CSS -->
  <link href="../../dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
  <link href="../../assets/css/ie10-viewport-bug-workaround.css" rel="stylesheet">

  <!-- Custom styles for this template -->
  <link href="../../css/dashboard.css" rel="stylesheet">
  <link href="../../css/theme.css" rel="stylesheet">

  <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
  <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
  <script src="../../assets/js/ie-emulation-modes-warning.js"></script>

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>

<body>
<nav class="navbar navbar-default navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="#">智慧城市计算数据展示平台</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="../index/index-main.html">首页<span class="sr-only">(current)</span></a></li>
        <li class="active"><a href="traffic-index.html">城市交通<span class="sr-only">(current)</span></a></li>
        <li><a href="../meteorology/meteorology-index.html">城市气象</a></li>
        <li><a href="../hydrology/hydrology-index.html">水文计算 </a></li>
      </ul>
    </div><!--/.nav-collapse -->
  </div>
</nav>
<div class="container-fluid">
  <div class="row">
    <div class="col-md-8 col-md-offset-2 main">
      <h1 class="page-header">北京市出租车用户出行规律分析</h1>
      <!--在下面填充内容-->
      <div>
        <div class="panel panel-primary">
          <div class="panel-heading">
            <h4>夜间上车点分布(20:00-次日5:00)</h4>
          </div>
          <div class="panel-body">
            <div class="row">
              <div class="col-sm-6" id="map" style="width: 600px;height:500px;"></div>
              <div class="col-sm-6">
                <table class="table table-responsive table-hover table-striped table-bordered">
                  <h3>夜间上车点区域排名</h3>
                  数据来自北京2015出租车交通数据
                  <thead>
                  <tr>
                    <th>排名</th>
                    <th>区域</th>
                    <th>拥堵指数</th>
                    <th>平均速度</th>
                  </tr>
                  </thead>
                  <tbody>
                  <tr>
                    <th>1</th>
                    <th>西城区</th>
                    <th>1.46</th>
                    <th>28.74</th>
                  </tr>
                  <tr>
                    <th>2</th>
                    <th>东城区</th>
                    <th>1.42</th>
                    <th>28.68</th>
                  </tr>
                  <tr>
                    <th>3</th>
                    <th>朝阳区</th>
                    <th>1.39</th>
                    <th>35.6</th>
                  </tr>
                  <tr>
                    <th>4</th>
                    <th>昌平区</th>
                    <th>1.36</th>
                    <th>28.06</th>
                  </tr>
                  <tr>
                    <th>5</th>
                    <th>海淀区</th>
                    <th>1.28</th>
                    <th>39.25</th>
                  </tr>
                  <tr>
                    <th>6</th>
                    <th>通州区</th>
                    <th>1.24</th>
                    <th>30.18</th>
                  </tr>
                  <tr>
                    <th>7</th>
                    <th>丰台区</th>
                    <th>1.2</th>
                    <th>40.92</th>
                  </tr>
                  <tr>
                    <th>8</th>
                    <th>大兴区</th>
                    <th>1.18</th>
                    <th>46.08</th>
                  </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        <div class="panel panel-success">
          <div class="panel-heading">
            <h4>日间上车点分布(6:00-19:00)</h4>
          </div>
          <div class="panel-body">
            <div class="row">
              <div class="col-sm-6" id="map2" style="width: 600px;height:500px;"></div>
              <div class="col-sm-6">
                <table class="table table-responsive table-hover table-striped table-bordered">
                  <h3>日间上车点区域排名</h3>
                  数据来自北京2015出租车交通数据
                  <thead>
                  <tr>
                    <th>排名</th>
                    <th>区域</th>
                    <th>拥堵指数</th>
                    <th>平均速度</th>
                  </tr>
                  </thead>
                  <tbody>
                  <tr>
                    <th>1</th>
                    <th>西城区</th>
                    <th>1.46</th>
                    <th>28.74</th>
                  </tr>
                  <tr>
                    <th>2</th>
                    <th>东城区</th>
                    <th>1.42</th>
                    <th>28.68</th>
                  </tr>
                  <tr>
                    <th>3</th>
                    <th>朝阳区</th>
                    <th>1.39</th>
                    <th>35.6</th>
                  </tr>
                  <tr>
                    <th>4</th>
                    <th>昌平区</th>
                    <th>1.36</th>
                    <th>28.06</th>
                  </tr>
                  <tr>
                    <th>5</th>
                    <th>海淀区</th>
                    <th>1.28</th>
                    <th>39.25</th>
                  </tr>
                  <tr>
                    <th>6</th>
                    <th>通州区</th>
                    <th>1.24</th>
                    <th>30.18</th>
                  </tr>
                  <tr>
                    <th>7</th>
                    <th>丰台区</th>
                    <th>1.2</th>
                    <th>40.92</th>
                  </tr>
                  <tr>
                    <th>8</th>
                    <th>大兴区</th>
                    <th>1.18</th>
                    <th>46.08</th>
                  </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="../../dist/js/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>
<script src="../../dist/js/bootstrap.min.js"></script>
<!-- Just to make our placeholder images work. Don't actually copy the next line! -->
<script src="../../assets/js/vendor/holder.min.js"></script>
<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<script src="../../assets/js/ie10-viewport-bug-workaround.js"></script>



<!--白天上车点分布-->
<script type="text/javascript">
    var map2 = new BMap.Map("map2", {});                        // 创建Map实例
    map2.centerAndZoom(new BMap.Point(116.404, 39.915), 12);     // 初始化地图,设置中心点坐标和地图级别
    map2.enableScrollWheelZoom();                            //启用滚轮放大缩小
    if (document.createElement('canvas').getContext) {
        var  mapStyle2 ={
            features: ["road", "building","water","land"],//隐藏地图上的poi
            style : ""  //设置地图风格为高端黑
        }
        map2.setMapStyle(mapStyle2);

        var BW2            = 0,    //canvas width
            BH2            = 0,    //canvas height
            ctx2           = null,
            stars2         = [],   //存储所有星星对象的数组
            timer2         = null, //定时器
            timeLine2      = null, //时间轴对象
            rs2            = [],   //最新的结果
            isNowTimeData2 = false, //是否显示当前时间的定位情况
            py2            = null, //偏移
            gridWidth2     = 10000,//网格的大小
            isOverlay2     = false,//是否叠加
            //gridWidth   = 1,//网格的大小
            canvas2        = null; //偏移

        function Star2(options){
            this.init(options);
        }

        Star2.prototype.init = function(options) {
            this.x   = ~~(options.x);
            this.y   = ~~(options.y);
            this.initSize(options.size);
            if (~~(0.5 + Math.random() * 7) == 1) {
                this.size = 0;
            } else {
                this.size = this.maxSize;
            }
        }

        Star2.prototype.initSize = function(size) {
            var size2 = ~~(size);
            this.maxSize = size2 > 6 ? 6 : size2;
        }

        Star2.prototype.render = function(i) {
            var p = this;

            if(p.x < 0 || p.y <0 || p.x > BW2 || p.y > BH2) {
                return;
            }

            ctx2.beginPath();
            var gradient = ctx2.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.size);
            gradient.addColorStop(0, "rgba(7,120,249,1)");
            gradient.addColorStop(1, "rgba(7,120,249,0.3)");
            ctx2.fillStyle = gradient;
            ctx2.arc(p.x, p.y, p.size, Math.PI*2, false);
            ctx2.fill();
            if (~~(0.5 + Math.random() * 7) == 1) {
                p.size = 0;
            } else {
                p.size = p.maxSize;
            }
        }

        function render2(){
            renderAction2();
            setTimeout(render2, 180);
        }

        function renderAction2() {
            ctx2.clearRect(0, 0, BW2, BH2);
            ctx2.globalCompositeOperation = "lighter";
            for(var i = 0, len = stars2.length; i < len; ++i){
                if (stars2[i]) {
                    stars2[i].render(i);
                }
            }
        }


        // 复杂的自定义覆盖物
        function ComplexCustomOverlay2(point){
            this._point = point;
        }
        ComplexCustomOverlay2.prototype = new BMap.Overlay();
        ComplexCustomOverlay2.prototype.initialize = function(map){
            this._map = map;
            canvas2 = this.canvas = document.createElement("canvas");
            canvas2.style.cssText = "position:absolute;left:0;top:0;";
            ctx2 = canvas2.getContext("2d");
            var size = map.getSize();
            canvas2.width = BW2 = size.width;
            canvas2.height = BH2 = size.height;
            map.getPanes().labelPane.appendChild(canvas2);
            //map.getContainer().appendChild(canvas);
            return this.canvas;
        }
        ComplexCustomOverlay2.prototype.draw = function(){
            var map = this._map;
            var bounds = map.getBounds();
            var sw = bounds.getSouthWest();
            var ne = bounds.getNorthEast();
            var pixel = map.pointToOverlayPixel(new BMap.Point(sw.lng, ne.lat));
            py2 = pixel;
            if (rs2.length > 0) {
                showStars2(rs2);
            }
        }
        var myCompOverlay2 = new ComplexCustomOverlay2(new BMap.Point(116.407845,39.914101));
        map2.addOverlay(myCompOverlay2);

        var project2 = map2.getMapType().getProjection();
        var bounds2 = map2.getBounds();
        var sw2 = bounds2.getSouthWest();
        var ne2 = bounds2.getNorthEast();
        sw2 = project2.lngLatToPoint(new BMap.Point(sw2.lng, sw2.lat));
        ne2 = project2.lngLatToPoint(new BMap.Point(ne2.lng, ne2.lat));

        //左上角墨卡托坐标点
        var original = {
            x : sw2.x,
            y : ne2.y
        }

        /**
         * 请求定位数据,并在地图上绘制出
         * @param 请求的时间
         * @param 成功后执行的回调函数
         *
         */
        var requestMgr2 = {
            request: function (time, successCbk) {
                var url2 =  "../../data/CData_20111101090000points";

                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function() {
                    if( xhr.readyState == 4  && xhr.status == 200 ) {
                        if (!isOverlay2) {
                            rs2 = JSON.parse(xhr.responseText);
                        } else {
                            rs2 = rs2.concat(JSON.parse(xhr.responseText));
                            if (rs2.length > 10000) {
                                rs2.splice(0, rs2.length - 10000);
                            }
                        }
                        showStars2(rs2);
                        if (successCbk) {
                            successCbk();
                        }
                    }
                }
                xhr.open( "GET", url2, true );
                xhr.send( null );
            }
        }

        //显示星星
        function showStars2(rs) {
            stars2.length = 0;
            var temp = {};
            for (var i = 0, len = rs.length; i < len; i++) {
                var item = rs[i];
                var addNum = gridWidth2 / 2;
                var x = item[0] * gridWidth2 + addNum;
                var y = item[1] * gridWidth2 + addNum;
                var point = project2.pointToLngLat(new BMap.Pixel(x, y));
                var px = map2.pointToOverlayPixel(point);
                //create all stars
                var s = new Star2({
                    x: px.x - py2.x,
                    y: px.y - py2.y,
                    size: item[2]
                });
                stars2.push(s);
                //}
            }
            canvas2.style.left = py2.x + "px";
            canvas2.style.top = py2.y + "px";
            renderAction2();
        }

        render2();

        function nowTimeCbk2 (time) {
            requestMgr2.request(time, function(){
                if (isNowTimeData2) {
                    setTimeout(function(){
                        if (isNowTimeData2) {
                            startCbk2(nowTimeCbk2);
                        }
                    }, 1000);
                }
            });
        }
        function startCbk2(cbk){
            var now = new Date();
            var time = {
                hour   : now.getHours(),
                minute : now.getMinutes(),
                second : now.getSeconds()
            };
            if (cbk) {
                cbk(time);
            }
        };
        startCbk2(nowTimeCbk2);
    } else {
        alert('请在chrome、safari、IE8+以上浏览器查看本示例');
    }
</script>
<!--夜晚上车点分布-->
<script type="text/javascript">
    var map = new BMap.Map("map", {});                        // 创建Map实例
    map.centerAndZoom(new BMap.Point(116.404, 39.915), 12);     // 初始化地图,设置中心点坐标和地图级别
    map.enableScrollWheelZoom();                            //启用滚轮放大缩小
    if (document.createElement('canvas').getContext) {
        var  mapStyle ={
            features: ["road", "building","water","land"],//隐藏地图上的poi
            style : "dark"  //设置地图风格为高端黑
        }
        map.setMapStyle(mapStyle);

        var BW            = 0,    //canvas width
            BH            = 0,    //canvas height
            ctx           = null,
            stars         = [],   //存储所有星星对象的数组
            timer         = null, //定时器
            timeLine      = null, //时间轴对象
            rs            = [],   //最新的结果
            isNowTimeData = false, //是否显示当前时间的定位情况
            py            = null, //偏移
            gridWidth     = 10000,//网格的大小
            isOverlay     = false,//是否叠加
            //gridWidth   = 1,//网格的大小
            canvas        = null; //偏移

        function Star(options){
            this.init(options);
        }

        Star.prototype.init = function(options) {
            this.x   = ~~(options.x);
            this.y   = ~~(options.y);
            this.initSize(options.size);
            if (~~(0.5 + Math.random() * 7) == 1) {
                this.size = 0;
            } else {
                this.size = this.maxSize;
            }
        }

        Star.prototype.initSize = function(size) {
            var size = ~~(size);
            this.maxSize = size > 6 ? 6 : size;
        }

        Star.prototype.render = function(i) {
            var p = this;

            if(p.x < 0 || p.y <0 || p.x > BW || p.y > BH) {
                return;
            }

            ctx.beginPath();
            var gradient = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.size);
            gradient.addColorStop(0, "rgba(7,120,249,1)");
            gradient.addColorStop(1, "rgba(7,120,249,0.3)");
            ctx.fillStyle = gradient;
            ctx.arc(p.x, p.y, p.size, Math.PI*2, false);
            ctx.fill();
            if (~~(0.5 + Math.random() * 7) == 1) {
                p.size = 0;
            } else {
                p.size = p.maxSize;
            }
        }

        function render(){
            renderAction();
            setTimeout(render, 180);
        }

        function renderAction() {
            ctx.clearRect(0, 0, BW, BH);
            ctx.globalCompositeOperation = "lighter";
            for(var i = 0, len = stars.length; i < len; ++i){
                if (stars[i]) {
                    stars[i].render(i);
                }
            }
        }


        // 复杂的自定义覆盖物
        function ComplexCustomOverlay(point){
            this._point = point;
        }
        ComplexCustomOverlay.prototype = new BMap.Overlay();
        ComplexCustomOverlay.prototype.initialize = function(map){
            this._map = map;
            canvas = this.canvas = document.createElement("canvas");
            canvas.style.cssText = "position:absolute;left:0;top:0;";
            ctx = canvas.getContext("2d");
            var size = map.getSize();
            canvas.width = BW = size.width;
            canvas.height = BH = size.height;
            map.getPanes().labelPane.appendChild(canvas);
            //map.getContainer().appendChild(canvas);
            return this.canvas;
        }
        ComplexCustomOverlay.prototype.draw = function(){
            var map = this._map;
            var bounds = map.getBounds();
            var sw = bounds.getSouthWest();
            var ne = bounds.getNorthEast();
            var pixel = map.pointToOverlayPixel(new BMap.Point(sw.lng, ne.lat));
            py = pixel;
            if (rs.length > 0) {
                showStars(rs);
            }
        }
        var myCompOverlay = new ComplexCustomOverlay(new BMap.Point(116.407845,39.914101));
        map.addOverlay(myCompOverlay);

        var project = map.getMapType().getProjection();
        var bounds = map.getBounds();
        var sw = bounds.getSouthWest();
        var ne = bounds.getNorthEast();
        sw = project.lngLatToPoint(new BMap.Point(sw.lng, sw.lat));
        ne = project.lngLatToPoint(new BMap.Point(ne.lng, ne.lat));

        //左上角墨卡托坐标点
        var original = {
            x : sw.x,
            y : ne.y
        }

        /**
         * 请求定位数据,并在地图上绘制出
         * @param 请求的时间
         * @param 成功后执行的回调函数
         *
         */
        var requestMgr = {
            request: function (time, successCbk) {
                var url =  "../../data/CData_20111101090000points";

                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function() {
                    if( xhr.readyState == 4  && xhr.status == 200 ) {
                        if (!isOverlay) {
                            rs = JSON.parse(xhr.responseText);
                        } else {
                            rs = rs.concat(JSON.parse(xhr.responseText));
                            if (rs.length > 10000) {
                                rs.splice(0, rs.length - 10000);
                            }
                        }
                        showStars(rs);
                        if (successCbk) {
                            successCbk();
                        }
                    }
                }
                xhr.open( "GET", url, true );
                xhr.send( null );
            }
        }

        //显示星星
        function showStars(rs) {
            stars.length = 0;
            var temp = {};
            for (var i = 0, len = rs.length; i < len; i++) {
                var item = rs[i];
                var addNum = gridWidth / 2;
                var x = item[0] * gridWidth + addNum;
                var y = item[1] * gridWidth + addNum;
                var point = project.pointToLngLat(new BMap.Pixel(x, y));
                var px = map.pointToOverlayPixel(point);
                //create all stars
                var s = new Star({
                    x: px.x - py.x,
                    y: px.y - py.y,
                    size: item[2]
                });
                stars.push(s);
                //}
            }
            canvas.style.left = py.x + "px";
            canvas.style.top = py.y + "px";
            renderAction();
        }

        render();

        function nowTimeCbk (time) {
            requestMgr.request(time, function(){
                if (isNowTimeData) {
                    setTimeout(function(){
                        if (isNowTimeData) {
                            startCbk(nowTimeCbk);
                        }
                    }, 1000);
                }
            });
        }
        function startCbk(cbk){
            var now = new Date();
            var time = {
                hour   : now.getHours(),
                minute : now.getMinutes(),
                second : now.getSeconds()
            };
            if (cbk) {
                cbk(time);
            }
        };
        startCbk(nowTimeCbk);
    } else {
        alert('请在chrome、safari、IE8+以上浏览器查看本示例');
    }
</script>
</body>
</html>
